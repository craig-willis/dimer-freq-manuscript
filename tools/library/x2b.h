#include <sstream>
#include <cmath>
#include "poly-2b.h" 

////////////////////////////////////////////////////////////////////////////////
namespace x2b {

const unsigned num_nonlinear_params = 5;
const unsigned num_linear_params = 596;
const unsigned num_vars = 15;
const double m_k_OO_intra = 8.896691154247711e-01;
const double m_k_CO_intra = 9.999999972194831e-01;
const double m_k_CC_inter = 1.486789478000526e-01;
const double m_k_CO_inter = 6.819046814139077e-01;
const double m_k_OO_inter = 4.858536325875394e-01;
const double d0_intra_CO = 1.180200000000000e+00;
const double d0_intra_OO = 2.360500000000000e+00;
const double d0_inter_CC = 4.000000000000000e+00;
const double d0_inter_CO = 4.000000000000000e+00;
const double d0_inter_OO = 4.000000000000000e+00;
const double m_r2i_small = 1.500000000000000e+00;
const double m_r2f_small = 2.000000000000000e+00;
const double m_r2i_long = 6.000000000000000e+00;
const double m_r2f_long = 8.000000000000000e+00;

inline double var_intra(const double& d0, const double& k, const double& d)
{
    return std::exp(k*(d0 - d));
}

inline double var_inter(const double& d0, const double& k, const double& d)
{
    return std::exp(k*(d0 - d))/d;
}

double sapt_s(const double* crd);
double f_switch(const double* xyz);
void cart_to_vars(const double* xyz, double* v, double& s);
double value(const double* xyz); 

const double poly[num_linear_params] = {
-5.446391894431963e+00, 1.154871617291557e+02,-1.025259310314965e+02,-1.283238462808858e+02,-1.912080922454777e+02,
 5.614969203123461e+01,-1.107547955058553e+01, 2.182587150842644e+02,-2.676212377918333e+01, 1.893435532173174e+02,
-1.946341865053961e+02, 5.048264663727458e+02,-2.778448497268923e+02,-2.423378908918794e+02, 1.917397379633683e+01,
-8.480532070827857e+01, 1.293963180811399e+02,-7.585252927851894e+01, 1.578454205555500e+02, 4.357228326680070e+02,
 4.674522716698456e+01,-6.868016511452640e+01,-2.091119265974275e+02,-1.750095304056587e+02,-1.799043102620710e+02,
 5.251757460029751e+01, 6.514224012697095e+01, 3.814888807319488e+01, 1.967245655247673e+02,-9.937676064367224e+00,
-2.888318701075575e+02, 1.812589189991340e+02,-1.605352428383150e+02,-8.600493116426213e+00,-6.976553116316732e+00,
 2.123590846646169e+02, 1.445618231343622e+02,-4.782441880220055e+01, 1.646470121496680e+01,-2.585943286684547e+02,
 4.404767759805816e+01,-9.665721917027282e+01,-1.906332586784648e+02, 5.266008570026324e+02,-1.036533482952288e+02,
 3.095822145898456e+02,-2.674597917251525e+01, 2.700397380771238e+02,-2.251542697255727e+02, 3.545040228165196e+02,
-2.231765595022844e+01,-1.153534878153201e+02,-2.634372050735748e+02,-8.963868177113286e+00, 5.277814645892667e+00,
 5.572479709006807e+01,-1.554479846354046e+02, 5.789681884749660e+01, 1.626772861608509e+02, 3.172591890106322e+02,
-2.738233881075369e+01, 8.595185165919847e+01,-1.058709699145938e+02,-6.939497571363083e+01,-1.571710140077109e+02,
-3.030968747662567e+01,-4.613243109297492e+02, 1.119965888999722e+02,-1.458742560170276e+02,-6.975888561139212e+01,
-1.975958760694178e+01, 2.743612133999923e+01, 7.434316162540259e+01,-4.593838578617149e+02,-6.762611411475767e+01,
-1.819883851208129e+02, 5.433924508401912e+01, 1.534038282972070e+02, 1.163864855138724e+03, 5.418266803325715e+02,
-1.721997222340990e+02, 9.479929480884358e+01,-1.068081954926258e+01, 4.362459735732653e+01,-2.365406192265631e+02,
-4.862022576029206e+00, 5.435390150986944e+01,-5.804717514026191e+02, 1.183347814839408e+02, 5.740012443855474e+02,
-1.507048767839838e+00,-1.931970062924637e+02, 1.473633863050500e+02,-1.398401764858527e+01, 1.164590937582098e+02,
-7.038185133157002e+01,-7.805961791493063e+01,-6.012160981068097e+01, 2.712597960393439e+02, 2.512181791244402e+02,
 3.907511175999441e+01, 7.803065700781228e+00,-1.103672496397965e+02,-1.379604376853072e+03, 4.162896432616051e+01,
 7.505305710898543e+01, 6.079945252724055e+01,-4.327156906556995e+01, 6.258946467177237e+02,-2.204481608089070e+02,
-4.235744105247939e+00, 1.044391684882162e+02, 3.110602948067192e+01,-1.738401895438956e+01,-1.567918267162502e+02,
-1.044112075996779e+02, 1.887215807160832e+02,-7.586426421346637e+01,-4.092137190899286e+02,-1.818897353015290e+02,
-6.921692819900413e+00,-1.743811158451824e+02, 5.130539250927601e+01,-3.110437187256889e+01,-4.032796470097486e+00,
-1.182588464084979e+02, 1.170993309350467e+03,-5.447837763860993e+01, 4.156977188741936e+01,-5.771576894165815e+01,
-1.896194602828849e+01, 2.460786329439407e+01,-7.218494971585990e+02, 9.565691811370925e+01,-1.076170289319987e+02,
-3.006796953107010e+00, 1.617518533512548e+02, 1.334833276084372e+02,-9.087859993801111e+01,-3.104652814190307e+02,
-3.830583203083037e+02, 7.908549114692904e+01,-9.396870032508414e+00, 2.991669642910794e+02, 7.468462529256482e+01,
 9.329845993318105e+01,-2.328693004863753e+01, 2.956114384330614e+02, 1.569840437351227e+01, 2.949123595302676e+02,
 4.467245604139786e+01, 4.388206434139329e+01, 3.038796706530678e+02,-3.401286778110186e+02, 2.233670776760648e+02,
-1.030217121734268e+02, 1.232410493962578e+02, 8.230135652401538e+02,-2.417794610922089e+02,-4.942197487855093e+01,
 3.917718042641951e+02, 1.587453684511245e+02,-9.054179969229554e+01, 1.361272682015902e+02,-1.072521317169619e+02,
-8.353026282073328e+01,-1.155974233064219e+02, 4.296392475239425e+02,-4.133503144233178e+01,-6.454525901510054e+01,
 3.918349746347887e+01,-2.974897017053156e+02,-3.175595550352460e+00, 1.717979084634694e+01,-6.800615971776073e+00,
-5.600892483243702e+01,-3.065488920732159e+02, 1.143239155435623e+03,-1.423055970823491e+02, 9.679752156339445e+01,
 3.037009352333482e+01, 1.548065923770612e+02,-3.398259962722052e+01,-4.115796406080003e+02,-7.423567775675924e+02,
 1.421168074850364e+02,-5.751613433200338e+01, 2.608688906614191e+01,-2.378686241208709e+02,-1.159206574388816e+03,
 4.193719584858876e+01,-3.744484991826509e+02, 1.549021314103158e+02,-5.280264589193894e+00,-1.303171345104585e+02,
 3.408935013245866e+02,-4.401456680362485e+01,-1.367491066082503e+03, 1.190566477581551e+02, 5.874589850100853e+01,
 2.078897091513359e+02,-3.902021755942348e+02,-1.714820484092118e+02,-1.875822003257131e+01,-3.821086897354684e+01,
 2.959269490977723e+02,-4.745525047398741e+02, 9.114431208559441e+01,-8.401664545956497e+01, 3.707109962979518e+01,
 1.746710463787052e+01, 7.576970450379735e+00,-2.587044171890291e+02, 3.230011555037017e+00,-2.790918173139110e+02,
 1.196772248029525e+02,-1.863743059621647e+02, 1.188942480654518e+01, 2.588409250194742e+02,-9.562784988470455e+01,
-2.268311915589750e+02, 3.917061667750581e+02,-1.414537914920612e+01, 3.580958345394757e+01,-2.709668858179128e+01,
-7.786136426093378e+01,-1.447041344201038e+01,-4.943427875667246e+02, 6.284120017347255e+02, 5.223121586108724e+01,
 3.884670648275999e+01,-1.270229088782303e+02,-1.710386567089396e+02, 1.044044312119170e+02,-2.791313127523139e+01,
-4.130131039188375e+01,-4.947021042790266e+01, 1.343457512926989e+02,-9.199483024361531e+02, 3.271203660516970e+01,
 6.289348211404217e+02,-1.118771230107977e+02,-7.223762196576759e+01, 2.108128650185473e+02, 1.090610021462293e+03,
 2.506312456736383e+02, 2.190045711594451e+00, 7.094254128123524e+01, 3.983302122968529e+01, 2.130385150167241e+02,
-4.864289049635294e+00,-9.252799257676966e+02, 1.562563324043716e+02,-1.270759167997428e+02,-4.992720961728987e+02,
 9.359262415288686e+02, 2.962456258792751e+02, 2.243117129722816e+02,-4.774575618085209e+01,-1.184785604600970e+02,
-1.405770122045975e+02, 2.975905874737225e+02, 7.916112918325962e+01, 6.594216451212414e+01, 7.862847359046354e+01,
 2.171947169283415e+02,-9.760520158164162e+01, 1.623614748582330e+02,-1.960433330630203e+00, 3.068043909608177e+02,
 2.131184847214246e+02,-5.483225301816505e+00, 6.014566812566309e+01,-5.000657153768324e+01, 5.122821027365640e+02,
-8.735896840968249e+01,-5.234376015238944e+02,-3.896083917493497e+01,-1.036736358382403e+02, 1.407902953680626e+02,
-5.320969926182907e+01,-3.697727842794282e+02,-1.233678203693189e+02,-2.356027535909725e+01, 2.596505758762631e+02,
 2.956620298589407e+01,-6.496725807428659e+01,-2.359536074062649e+02, 2.128146304150479e+02,-1.535684907612225e+02,
 1.779889917680995e+02, 7.368369898004671e+02, 3.525664887519033e+01,-5.837575902586211e+00, 5.271232000640763e+02,
 1.949278441657101e+02,-4.199324851429886e+02, 2.643868433297060e+02,-1.763609976091518e+02, 1.751953782497720e+02,
-1.018040635605663e+02,-3.838637269223362e+02, 1.062513335142565e+01,-3.340990125967668e+02,-1.856037608803062e+03,
 6.834899555834344e+00,-1.227702715699600e+02,-1.022149930712255e+02, 8.314534477999571e+02,-5.321791325580696e+01,
 5.717215625178110e+01,-2.977504303483643e+02, 7.633595773802368e+01, 6.452588094704093e+02, 6.456963176049861e+01,
-9.430017323467357e+02, 1.189992966185767e+02, 3.146219688426855e+00,-6.199736435339233e+01, 6.160137629288273e+01,
-3.382688760061373e+01,-2.292177524364074e+02, 2.075315851263391e+02, 2.208257732933689e+02,-5.446007139926495e+01,
 5.705947076178779e+01, 2.854731843807284e+02, 1.178869058182834e+02,-1.194142743339097e+02,-6.602958722761832e+01,
 8.981269008207946e+01,-2.803312296564859e+02,-2.653822961212471e+01,-1.809224542481969e+01, 9.369615023426546e+01,
 1.393618745152206e+02, 2.462831826255835e+02,-1.793631467675560e+01, 1.169830288366433e+02, 2.200826608838900e+02,
 2.312373887481860e+03, 6.759919194602415e+01,-4.053457959810176e+01,-8.718645731445042e+01, 2.136734851018762e+02,
-2.412728777751995e+02, 7.431841768272999e+00,-3.490743939735540e+01,-1.758407836434133e+02, 3.392142470340981e+01,
-2.849785305876152e+01, 3.206461262040148e+02, 2.044090245398586e+02, 8.398533758436589e+01, 4.637513303545269e+00,
 5.666334708161606e+01,-9.841244700410153e-01, 3.012134684750510e+02, 9.429328636907512e+01,-7.051220724844814e+01,
 2.747767265642128e+01, 1.565351278787524e+02, 2.019245334613437e+02,-1.078235912759452e+02, 1.133714227708166e+02,
 1.859624798672794e+02,-3.212045856152564e+01,-1.524940062326575e+01,-4.109789528561955e+02, 1.240066450294648e+02,
-3.363477911183692e+02, 5.474750557173999e+01,-2.234396821731416e+02,-6.114582550338152e+02,-1.443872396179652e+02,
 1.459081045475182e+01, 5.428501160565934e+01, 8.532439285661388e+01,-3.776569752597536e+02,-2.912463620168779e+02,
-1.731374510799365e+01, 1.675598968322419e+01, 1.163920173924520e+02, 7.202301877135979e+01,-1.100089298837507e+02,
-3.090037522065642e+02, 1.255684710005051e+02,-3.210552099732386e+01,-6.984522124332969e+01, 1.976264297608607e+01,
-3.800878133488687e+02, 5.948077949728565e+02, 1.825710112661038e+02, 1.452896207343842e+02,-2.820235070298826e+02,
-4.185305255612816e+01, 1.851806080129851e+02, 5.096871487204719e+01, 1.310088569703330e+02,-4.647171715722276e+01,
 9.189176872857529e+01, 8.707871138066092e+01, 1.299324005598168e+03,-1.384548656512324e+02, 5.770536181192249e+00,
 7.210131466710817e+01,-1.701600868805273e+02,-2.825289745899981e+01,-3.872207212679257e+02, 1.046475309384279e+02,
 7.502052540962970e+01,-2.478029031847942e+02, 3.726851417447323e+02,-1.352066992628434e+02,-5.870263348742446e+02,
-1.475520269480130e+02,-2.971568072653034e+01,-2.834374573580229e+02,-4.850262391533730e+01,-1.303779030464517e+02,
-3.846788575533438e+02, 1.006476676439241e+02,-4.158296004236569e+01,-1.460266175061452e+02,-1.528031745147417e+02,
 1.777241579962191e+01,-1.599862531682296e+02,-5.373876812960457e+01,-1.269272192296083e+02,-1.065269633336108e+02,
-8.405628672903579e+01,-5.654166057560877e+02,-5.792429093532665e+01, 2.327180666611716e+02, 2.713900241642522e+02,
 9.695630453772381e+01, 2.931200567945124e+01, 1.015683080875784e+01,-5.653097302475491e+01, 2.353310485373502e+02,
 5.158183502400895e+01, 6.688392141293006e+01, 2.211348127553080e+02, 2.373643079585886e+02,-3.901005332391550e+00,
-1.614969869255935e+02, 1.088066902373688e+02, 8.401842022207502e+00,-1.756414285846879e+01, 1.708303398937842e+03,
 5.371239677883934e+02, 1.461521959776820e+02,-2.765558520575398e+02,-1.473793477201910e+02, 1.319616748265791e+02,
-4.156994243785754e+01, 7.450957057704184e+02, 4.690700708557224e+01,-4.128288773632883e+02,-3.469003378620295e+02,
 1.446603952042471e+02,-5.458649735544284e+02,-5.001850134839295e+00, 3.074402133778467e+02,-2.676501073957368e+02,
 8.359399448380771e+01, 1.231159733723212e+02,-1.166725053059301e+03,-2.703543703323262e+02,-1.311286918643013e+02,
-2.043609981426489e+02, 2.014189059298391e+02, 1.348317891788748e+02, 9.870945536992224e+01, 5.041326784638147e+01,
 6.341482907021855e+01, 1.527665372493407e+01, 3.239660542521246e+01,-8.618177763724409e-01,-3.057032089140448e+02,
 1.103248694778824e+02,-7.397182642874087e+01, 1.284725231678947e+02,-4.307974851463182e+01,-4.171001117697548e+02,
 9.666492000212418e+01,-1.183312003891961e+02,-1.678109339532221e+01,-3.312592473667584e+00, 2.510862443473009e+02,
-2.246649450110958e+02, 2.401165263155772e+02,-4.746343563265026e+01,-1.465466273972306e+01,-2.054733540149159e+02,
 2.023525852907323e+02,-8.733591149663846e+01,-5.422337098385561e+01,-1.226048312653860e+02, 1.562965976003764e+02,
 8.147478090498971e+00, 6.774484681778871e+01,-2.128340846819234e+02, 1.064029896257172e+03,-1.318155185602524e+03,
 7.822812811083520e+01,-1.102845716862785e+03, 1.370080217457836e+02,-2.997046497263835e+01, 1.600353954120508e+01,
 3.402930310407062e+02,-1.025146742237126e+02, 5.586587076601835e+01, 1.236590376860491e+03, 8.072463384058443e+01,
-6.863910575138090e+01,-1.898778073666981e+02, 6.958240503468983e+01, 5.679982790082080e+01,-1.005989891700062e+02,
-6.410710929342474e+01, 6.661117296581714e+02, 3.421475645607094e+02,-2.771319124479061e+02, 4.626666230501794e+01,
-1.263528191056865e+02, 9.026067090776952e+02,-1.756256226628997e+02,-8.589397977489517e+01, 1.289992044012944e+02,
-1.981287603627068e+02, 8.962513285182870e+02, 1.527139534170716e+02, 1.174040755375131e+02,-1.710686179788139e+02,
-6.562583231356533e+01, 1.926830228032877e-01,-1.182742751050858e+03,-7.496365980345070e+01,-8.807344182228394e+02,
-8.422494649463115e+00,-1.422504399901755e+01,-5.478200432298936e+01,-9.949436373052807e+00, 8.858760573732686e+02,
-1.524520186100250e+01, 7.014081995309230e+02,-3.176430196873675e+02,-1.087811319507795e+01, 7.093093506778141e+01,
-7.833627382472624e+02, 4.863828706119065e+00,-2.409608124948029e+02, 1.498699970856438e+02, 7.471584143167573e+01,
-1.087074609364620e+02,-1.907788590750886e+02, 2.670078111949231e+02, 1.605405584417371e+02, 7.482697432647409e+01,
-1.813642393197272e+02, 2.061214942523328e+02, 3.073004096662628e+01,-4.574303741973878e+00, 6.444844034080039e+01,
-6.342451176302946e+01,-2.564166911805680e+02,-5.106317997241649e+02, 4.565403974777288e+02,-1.447697222467295e+03,
-2.033891198192524e+02, 3.611366944128341e+01,-3.066397607934923e+02, 3.082844080480133e+02,-2.059416978166236e+02,
-9.201089444968374e+02,-9.514158002445868e+02, 3.719277287943532e+01, 6.150889166920788e+01, 2.454873140603444e+02,
-2.075061911985626e+02,-5.157625883280240e+01,-2.280382769206949e+01, 6.147124694744865e+00,-7.678815472655253e+01,
 1.415166962299443e+03, 4.326965262258647e+01, 7.800005827019414e+02,-3.434376584373192e+02, 2.553985561594646e+02,
-5.042434518689035e+02,-1.050365618930612e+02,-3.832612605206249e+01,-8.867899329284529e+01, 7.484136028439144e+01,
 2.787535237285952e+01};

} // namespace x2b

////////////////////////////////////////////////////////////////////////////////

